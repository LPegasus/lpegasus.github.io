(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{77:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return u})),t.d(n,"metadata",(function(){return c})),t.d(n,"toc",(function(){return a})),t.d(n,"default",(function(){return l}));var o=t(3),s=t(7),r=(t(0),t(90)),u={title:"useEffect"},c={unversionedId:"hooks/use-effect",id:"hooks/use-effect",isDocsHomePage:!1,title:"useEffect",description:"useEffect \u662f\u7b2c\u4e8c\u6700\u5e38\u7528\u7684 hooks",source:"@site/docs/hooks/use-effect.mdx",slug:"/hooks/use-effect",permalink:"/docs/hooks/use-effect",editUrl:"https://github.com/LPegasus/tutorial-bytedance-fe/docs/hooks/use-effect.mdx",version:"current"},a=[{value:"\u7ed1\u5b9a\u4e8b\u4ef6",id:"\u7ed1\u5b9a\u4e8b\u4ef6",children:[]},{value:"state \u9a71\u52a8 DOM \u64cd\u4f5c",id:"state-\u9a71\u52a8-dom-\u64cd\u4f5c",children:[]},{value:"I/O \u64cd\u4f5c",id:"io-\u64cd\u4f5c",children:[]}],i={toc:a};function l(e){var n=e.components,t=Object(s.a)(e,["components"]);return Object(r.b)("wrapper",Object(o.a)({},i,t,{components:n,mdxType:"MDXLayout"}),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"useEffect")," \u662f\u7b2c\u4e8c\u6700\u5e38\u7528\u7684 hooks"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"useEffect")," \u5728\u6d4f\u89c8\u5668\u73af\u5883\u624d\u4f1a\u6267\u884c\uff0c\u5728\u670d\u52a1\u7aef\u73af\u5883\u4e0d\u4f1a\u6267\u884c"),Object(r.b)("p",null,"\u901a\u5e38 ",Object(r.b)("inlineCode",{parentName:"p"},"useEffect")," \u7528\u6765\u5904\u7406 react \u7684\u526f\u4f5c\u7528\uff0c\u5e38\u89c1\u7684\u5982\uff1a"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"\u6ce8\u518c\u76d1\u542c\u5668"),Object(r.b)("li",{parentName:"ul"},"\u521b\u5efa\u8ba1\u65f6\u5668"),Object(r.b)("li",{parentName:"ul"},"\u505a ",Object(r.b)("em",{parentName:"li"},"DOM")," \u64cd\u4f5c"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("em",{parentName:"li"},"I/O")," \u64cd\u4f5c")),Object(r.b)("h2",{id:"\u7ed1\u5b9a\u4e8b\u4ef6"},"\u7ed1\u5b9a\u4e8b\u4ef6"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-tsx",metastring:"live",live:!0},"// \u5b9e\u73b0\u4e00\u4e2a\u73b0\u5b9e\u6eda\u52a8\u6761\u7684\u7ec4\u4ef6\nreturn () => {\n  const [scrollPosition, setScrollPosition] = useState('');\n\n  useEffect(() => {\n    const handler = () => {\n      setScrollPosition(\n        `top: ${documentElement.scrollTop}, left: ${documentElement.scrollLeft}`\n      );\n    };\n    const documentElement = document.documentElement;\n    window.addEventListener('scroll', handler, { passive: true });\n    // \u5173\u4e8e passive \u7684\u4f5c\u7528\uff0c\u540e\u7eed\u7684\u6027\u80fd\u4f18\u5316\u4f1a\u8bb2\n    return () => {\n      window.removeEventListener('scroll', handler);\n    };\n  }, []);\n  return <p>{scrollPosition}</p>;\n};\n")),Object(r.b)("h2",{id:"state-\u9a71\u52a8-dom-\u64cd\u4f5c"},"state \u9a71\u52a8 DOM \u64cd\u4f5c"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-tsx",metastring:"live",live:!0},'return () => {\n  const [speed, setSpeed] = useState(1.0);\n  const [musicSrc, setMusicSrc] = useState(\'/audio/music1.flac\');\n  const [volume, setVolume] = useState(1.0);\n  const [loadError, setLoadError] = useState(false);\n  const audioRef = useRef<HTMLAudioElement | null>(null);\n\n  useEffect(() => {\n    const audio = audioRef.current;\n    if (!audio) {\n      return;\n    }\n    audio.playbackRate = speed;\n  }, [speed]);\n\n  useEffect(() => {\n    const audio = audioRef.current; // \u8bf4\u660e\u4e3a\u4f55\u4e00\u5b9a\u8981\u5148\u53d6\u53d8\u91cf\n    audio.onerror = () => {\n      setLoadError(true);\n    };\n    return () => {\n      audio.onerror = null;\n    };\n  }, []);\n\n  return (\n    <>\n      <select value={speed} onChange={(e) => setSpeed(e.target.value)}>\n        <option value={0.5}>0.5</option>\n        <option value={1.0}>1.0</option>\n        <option value={1.5}>1.5</option>\n        <option value={2.0}>2.0</option>\n      </select>\n      <select value={musicSrc} onChange={(e) => setMusicSrc(e.target.value)}>\n        <option value="/audio/music1.flac">music1</option>\n        <option value="/audio/music2.flac">music2</option>\n      </select>\n      {loadError ? (\n        <div>\n          <strong>Music load failed.</strong>\n        </div>\n      ) : (\n        <figure>\n          <figcaption>Music</figcaption>\n          <audio controls src={musicSrc} ref={audioRef}>\n            Your browser does not support the\n          </audio>\n        </figure>\n      )}\n    </>\n  );\n};\n')),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"\u7ec3\u4e60\uff1a\u5c1d\u8bd5\u6dfb\u52a0\u4e00\u4e2a\u9009\u62e9\u5668\uff0c\u589e\u52a0\u97f3\u4e50\u9009\u62e9\u529f\u80fd")),Object(r.b)("h2",{id:"io-\u64cd\u4f5c"},"I/O \u64cd\u4f5c"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-tsx",metastring:"live",live:!0},"return () => {\n  const [user, setUser] = useState(null);\n\n  useEffect(() => {\n    // let cancel = false;\n    (async () => {\n      // IIFE\n      const resp = await github.searchUser('LPegasus');\n      setUser(resp);\n    })();\n    // return () => (cancel = true);\n  }, []);\n\n  return (\n    <div>\n      {user && (\n        <fieldset>\n          <legend style={{ width: 'max-content' }}>{user.name}</legend>\n          <div>{new Date(user.createdAt).getFullYear()} \u6ce8\u518c github</div>\n          <div>{user.followers.totalCount}\u4e2a\u7c89\u4e1d</div>\n          <div\n            style={{\n              display: 'flex',\n              alignItems: 'center',\n            }}\n          >\n            <img\n              style={{ width: 48, borderRadius: '50%', marginRight: 14 }}\n              src={user.avatarUrl}\n            />{' '}\n            \u5934\u50cf\n          </div>\n        </fieldset>\n      )}\n      {/*<pre>\n        <code>{JSON.stringify(user, null, '  ')}</code>\n      </pre>*/}\n    </div>\n  );\n};\n")),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"\u8bb2\u89e3\u6d4f\u89c8\u5668\u73af\u5883\u5173\u4e8e\u5f02\u6b65\u64cd\u4f5c\u7684\u7406\u89e3\n\u8054\u7cfb\uff1a\u8865\u5145\u4e0a\u9762\u4ee3\u7801\uff0c\u6dfb\u52a0\u4e00\u4e2a input \u6846\uff0c\u641c\u7d22\u4e0d\u540c\u7684 github \u8d26\u53f7")))}l.isMDXComponent=!0}}]);